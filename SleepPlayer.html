<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Âä©Áú†Êí≠ÊîæÂô® | Sleep Player</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Google Fonts (Optional for better look) -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', sans-serif; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        @keyframes spin-slow {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .animate-spin-slow {
            animation: spin-slow 10s linear infinite;
        }
        .animate-pulse-slow {
            animation: pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
    </style>
</head>
<body class="bg-slate-950 text-slate-100 overflow-hidden">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useRef, useEffect } = React;

        /**
         * üéµ Sleep Player (Âä©Áú†Êí≠ÊîæÂô®)
         * * [Github Pages ÈÉ®ÁΩ≤ËØ¥Êòé]
         * 1. Â∞ÜÊ≠§ index.html ÈÉ®ÁΩ≤Âà∞ Github Pages„ÄÇ
         * 2. Âú®‰ªìÂ∫ì‰∏≠ÂàõÂª∫‰∏Ä‰∏™Âêç‰∏∫ "media" ÁöÑÊñá‰ª∂Â§π„ÄÇ
         * 3. Â∞Ü‰Ω†ÁöÑ mp3/mp4 Êñá‰ª∂ÊîæÂÖ• "media" Êñá‰ª∂Â§π„ÄÇ
         * 4. In the default `DEFAULT_TRACKS` array (below) update file names, or let the app auto-scan ./Media.
         */

        // --- Default media list (will be replaced by auto-scan of ./Media when available) ---
        const DEFAULT_TRACKS = [
            {
                id: 1,
                title: { zh: "ÂçàÂ§úÈõ®Â£∞", en: "Midnight Rain" },
                artist: { zh: "Â§ßËá™ÁÑ∂", en: "Nature Sounds" },
                type: "audio",
                // ÈÉ®ÁΩ≤Êó∂Êîπ‰∏∫: "./media/rain.mp3"
                url: "https://cdn.pixabay.com/download/audio/2022/03/24/audio_cda84bf8e7.mp3?filename=rain-and-thunder-111456.mp3", 
                cover: "blue" 
            },
            {
                id: 2,
                title: { zh: "Ê∑±Á©∫‰ø°Âè∑", en: "Deep Space" },
                artist: { zh: "ÁôΩÂô™Èü≥", en: "White Noise" },
                type: "audio",
                // ÈÉ®ÁΩ≤Êó∂Êîπ‰∏∫: "./media/space.mp3"
                url: "https://cdn.pixabay.com/download/audio/2022/05/27/audio_1808fbf07a.mp3?filename=lofi-study-112778.mp3",
                cover: "purple"
            },
            {
                id: 3,
                title: { zh: "Ê£ÆÊûóÊ∫™ÊµÅ (ËßÜÈ¢ë)", en: "Forest Stream" },
                artist: { zh: "ËßÜËßâÊ∞õÂõ¥", en: "Visual Ambience" },
                type: "video",
                // ÈÉ®ÁΩ≤Êó∂Êîπ‰∏∫: "./media/forest.mp4"
                url: "https://cdn.pixabay.com/video/2020/05/25/40158-424933979_tiny.mp4",
                cover: "green"
            }
        ];

        // --- ËØ≠Ë®ÄÂåÖÈÖçÁΩÆ ---
        const TRANSLATIONS = {
            zh: {
                appName: "Âä©Áú†Êí≠ÊîæÂô®",
                slogan: "‰∏ìÊ≥®Áù°Áú†‰∏éÁôΩÂô™Èü≥",
                library: "Â™í‰ΩìÂ∫ì",
                timer: "ÂÆöÊó∂ËÆæÁΩÆ",
                playing: "Ê≠£Âú®Êí≠Êîæ",
                systemVolume: "Á≥ªÁªüÈü≥ÈáèÊéßÂà∂",
                stealthHint: "ÁÜÑÂ±èÊ®°Âºè",
                stealthExit: "ÁÇπÂáª‰ªªÊÑèÂ§ÑÈÄÄÂá∫ÈªëÂ±èÊ®°Âºè",
                empty: "ÊöÇÊó†Â™í‰Ωì",
                timerOptions: {
                "1h": "1 Â∞èÊó∂",
                "full": "‰∏çÈôêÊó∂",
                "random": "ÈöèÊú∫",
                "custom": "Ëá™ÂÆö‰πâ"
                },
                units: {
                min: "ÂàÜÈíü"
                }
            },
            en: {
                appName: "Sleep Player",
                slogan: "Sleep & White Noise",
                library: "Media Library",
                timer: "Timer Settings",
                playing: "Now Playing",
                systemVolume: "System Volume",
                stealthHint: "Stealth Mode",
                stealthExit: "Tap anywhere to wake up",
                empty: "No Media Found",
                timerOptions: {
                "1h": "1 Hour",
                "full": "Infinite",
                "random": "Random",
                "custom": "Custom"
                },
                units: {
                min: "Mins"
                }
            }
        };

        // --- Icons (Inline SVG Components) ---
        const IconMoon = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"/></svg>;
        const IconClock = ({ size }) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>;
        const IconVideo = ({ size, className }) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="m22 8-6 4 6 4V8Z"/><rect width="14" height="12" x="2" y="6" rx="2" ry="2"/></svg>;
        const IconMusic = ({ size, className }) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M9 18V5l12-2v13"/><circle cx="6" cy="18" r="3"/><circle cx="18" cy="16" r="3"/></svg>;
        const IconPlay = ({ size, fill, className }) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill={fill} stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polygon points="5 3 19 12 5 21 5 3"/></svg>;
        const IconPause = ({ size, fill }) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill={fill} stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="4" height="16" x="6" y="4"/><rect width="4" height="16" x="14" y="4"/></svg>;
        const IconShuffle = ({ size }) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M2 18h1.4c1.3 0 2.5-.6 3.3-1.7l14.2-12.6c.8-1.1 2-1.7 3.3-1.7H22"/><path d="M2 6h1.4c1.3 0 2.5.6 3.3 1.7l14.2 12.6c.8 1.1 2 1.7 3.3 1.7H22"/></svg>;
        const IconRepeat = ({ size }) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m17 2 4 4-4 4"/><path d="M3 11v-1a4 4 0 0 1 4-4h14"/><path d="m7 22-4-4 4-4"/><path d="M21 13v1a4 4 0 0 1-4 4H3"/></svg>;
        const IconVolume2 = ({ size }) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/><path d="M15.54 8.46a5 5 0 0 1 0 7.07"/><path d="M19.07 4.93a10 10 0 0 1 0 14.14"/></svg>;
        const IconEyeOff = ({ size }) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M9.88 9.88a3 3 0 1 0 4.24 4.24"/><path d="M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68"/><path d="M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7c.44 0 .87-.03 1.28-.09"/><path d="m2 2 20 20"/></svg>;
        const IconChevronLeft = ({ size }) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m15 18-6-6 6-6"/></svg>;


        const App = () => {
            // --- State ---
            const [lang, setLang] = useState('zh'); // 'zh' | 'en'
            const [view, setView] = useState('selection'); // 'selection' | 'player'
            const [currentTrackIndex, setCurrentTrackIndex] = useState(0);
            const [tracks, setTracks] = useState(DEFAULT_TRACKS);
            const [scanStatus, setScanStatus] = useState('idle'); // 'idle' | 'scanning' | 'done' | 'error' | 'picker'
            const [isPlaying, setIsPlaying] = useState(false);
            const [stealthMode, setStealthMode] = useState(false);
            
            // Timer Settings
            const [timerMode, setTimerMode] = useState('1h');
            const [customMinutes, setCustomMinutes] = useState(30);
            const [timeLeft, setTimeLeft] = useState(null);

            const audioRef = useRef(null);
            const videoRef = useRef(null);
            const timerRef = useRef(null);

            const t = TRANSLATIONS[lang];
            const currentTrack = tracks[currentTrackIndex];

            // --- Logic ---

            const toggleLang = () => {
                setLang(prev => prev === 'zh' ? 'en' : 'zh');
            };

            useEffect(() => {
                // On mount try to auto-scan ./Media folder
                (async function tryAutoScan() {
                    await scanMediaFolder();
                })();

                if (isPlaying && timeLeft !== null && timeLeft > 0) {
                timerRef.current = setInterval(() => {
                    setTimeLeft((prev) => {
                    if (prev <= 1) {
                        handleTimerEnd();
                        return 0;
                    }
                    return prev - 1;
                    });
                }, 1000);
                } else if (!isPlaying || timeLeft === 0) {
                clearInterval(timerRef.current);
                }
                return () => clearInterval(timerRef.current);
            }, [isPlaying, timeLeft]);

            // --- Media scanning utilities ---
            const extToType = (name) => {
                const ext = name.split('.').pop().toLowerCase();
                if (['mp3','wav','ogg','m4a','flac'].includes(ext)) return 'audio';
                if (['mp4','webm','ogv','mov','mkv'].includes(ext)) return 'video';
                return 'other';
            }

            // Try to fetch directory index from ./Media/ and parse links (works when a static server exposes directory listings)
            const scanMediaFolder = async () => {
                setScanStatus('scanning');
                try {
                    const resp = await fetch('./Media/');
                    if (!resp.ok) throw new Error('No directory listing');
                    const text = await resp.text();
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(text, 'text/html');
                    const anchors = Array.from(doc.querySelectorAll('a'));
                    const files = anchors.map(a => a.getAttribute('href')).filter(h => h && !h.endsWith('/'));
                    const filtered = files.filter(name => /\.(mp3|wav|ogg|m4a|flac|mp4|webm|ogv|mov|mkv)$/i.test(name));
                    if (filtered.length === 0) throw new Error('No media found in directory listing');
                    const newTracks = filtered.map((name, i) => {
                        const cleanName = name.split('/').pop();
                        const type = extToType(cleanName);
                        return {
                            id: Date.now() + i,
                            title: { zh: cleanName, en: cleanName },
                            artist: { zh: 'Local', en: 'Local' },
                            type,
                            url: `./Media/${cleanName}`,
                            cover: type === 'video' ? 'green' : 'blue'
                        }
                    });
                    setTracks(newTracks);
                    setScanStatus('done');
                    // reset current index
                    setCurrentTrackIndex(0);
                    return;
                } catch (err) {
                    console.log('Auto-scan failed:', err);
                    setScanStatus('error');
                }

                // Fallback: ask user to pick the Media folder via File System Access API (requires user gesture)
                if ('showDirectoryPicker' in window) {
                    setScanStatus('picker');
                } else {
                    setScanStatus('error');
                }
            }

            const pickMediaFolder = async () => {
                try {
                    const dirHandle = await window.showDirectoryPicker();
                    const newTracks = [];
                    for await (const [name, handle] of dirHandle.entries()) {
                        if (handle.kind === 'file' && /\.(mp3|wav|ogg|m4a|flac|mp4|webm|ogv|mov|mkv)$/i.test(name)) {
                            const type = extToType(name);
                            newTracks.push({
                                id: Date.now() + newTracks.length,
                                title: { zh: name, en: name },
                                artist: { zh: 'Local', en: 'Local' },
                                type,
                                url: URL.createObjectURL(await handle.getFile()),
                                cover: type === 'video' ? 'green' : 'blue'
                            });
                        }
                    }
                    if (newTracks.length) {
                        setTracks(newTracks);
                        setScanStatus('done');
                        setCurrentTrackIndex(0);
                    } else {
                        setScanStatus('error');
                    }
                } catch (e) {
                    console.log('Directory picker cancelled or failed', e);
                    setScanStatus('error');
                }
            }

            const handleTimerEnd = () => {
                setIsPlaying(false);
                pauseMedia();
            };

            const startPlayback = (trackIndex) => {
                setCurrentTrackIndex(trackIndex);
                setView('player');
                setIsPlaying(true);
                
                let seconds = null;
                if (timerMode === '1h') seconds = 3600;
                else if (timerMode === 'custom') seconds = customMinutes * 60;
                else if (timerMode === 'random') seconds = Math.floor(Math.random() * (5400 - 1800) + 1800);
                
                setTimeLeft(seconds);
                setTimeout(() => playMedia(), 100);
            };

            const playMedia = () => {
                if (currentTrack.type === 'audio' && audioRef.current) {
                audioRef.current.play().catch(e => console.log("Playback error", e));
                } else if (currentTrack.type === 'video' && videoRef.current) {
                videoRef.current.play().catch(e => console.log("Playback error", e));
                }
            };

            const pauseMedia = () => {
                if (audioRef.current) audioRef.current.pause();
                if (videoRef.current) videoRef.current.pause();
            };

            const togglePlay = () => {
                if (isPlaying) {
                pauseMedia();
                } else {
                playMedia();
                }
                setIsPlaying(!isPlaying);
            };

            const formatTime = (seconds) => {
                if (seconds === null) return "‚àû";
                const h = Math.floor(seconds / 3600);
                const m = Math.floor((seconds % 3600) / 60);
                const s = seconds % 60;
                if (h > 0) return `${h}:${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
                return `${m}:${s.toString().padStart(2, '0')}`;
            };

            // --- Components ---

            const TimerSelector = () => (
                <div className="bg-white/5 backdrop-blur-md rounded-2xl p-4 mb-6 border border-white/10">
                <h3 className="text-sm font-medium text-slate-400 mb-3 flex items-center gap-2">
                    <IconClock size={16} /> {t.timer}
                </h3>
                <div className="grid grid-cols-4 gap-2 mb-4">
                    {[
                    { id: '1h', label: t.timerOptions["1h"] },
                    { id: 'full', label: t.timerOptions["full"] },
                    { id: 'random', label: t.timerOptions["random"] },
                    { id: 'custom', label: t.timerOptions["custom"] }
                    ].map((mode) => (
                    <button
                        key={mode.id}
                        onClick={() => setTimerMode(mode.id)}
                        className={`text-xs py-2 px-1 rounded-lg transition-all duration-300 truncate ${
                        timerMode === mode.id 
                            ? 'bg-indigo-500 text-white shadow-lg shadow-indigo-500/30' 
                            : 'bg-white/5 text-slate-400 hover:bg-white/10'
                        }`}
                    >
                        {mode.label}
                    </button>
                    ))}
                </div>
                
                {timerMode === 'custom' && (
                    <div className="px-2">
                    <div className="flex justify-between text-xs text-slate-400 mb-2">
                        <span>10 {t.units.min}</span>
                        <span className="text-indigo-400 font-bold">{customMinutes} {t.units.min}</span>
                        <span>180 {t.units.min}</span>
                    </div>
                    <input
                        type="range"
                        min="10"
                        max="180"
                        value={customMinutes}
                        onChange={(e) => setCustomMinutes(Number(e.target.value))}
                        className="w-full h-1.5 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-indigo-500 hover:accent-indigo-400"
                    />
                    </div>
                )}
                </div>
            );

            // --- Views ---

            if (stealthMode) {
                return (
                <div 
                    className="fixed inset-0 bg-black z-[9999] cursor-none touch-none flex items-center justify-center text-neutral-800"
                    onClick={() => setStealthMode(false)}
                >
                    {/* ÂæÆÂº±ÊèêÁ§∫ */}
                    <span className="opacity-10 text-xs select-none">{t.stealthExit}</span>
                </div>
                );
            }

            return (
                <div className="min-h-screen bg-slate-950 text-slate-100 font-sans selection:bg-indigo-500/30 overflow-hidden relative">
                    {/* Background Ambient Glows */}
                    <div className="fixed top-[-10%] left-[-10%] w-[500px] h-[500px] bg-indigo-900/20 rounded-full blur-[120px] pointer-events-none" />
                    <div className="fixed bottom-[-10%] right-[-10%] w-[500px] h-[500px] bg-purple-900/20 rounded-full blur-[120px] pointer-events-none" />

                    {/* Main Content Container */}
                    <div className="relative z-10 max-w-md mx-auto h-screen flex flex-col">
                        
                        {/* --- Selection Screen --- */}
                        {view === 'selection' && (
                        <div className="flex-1 flex flex-col p-6 animate-in fade-in zoom-in-95 duration-500">
                            <header className="flex justify-between items-center mb-8 mt-4">
                            <div>
                                <h1 className="text-3xl font-bold text-white tracking-tight">
                                {t.appName}
                                </h1>
                                <p className="text-xs text-slate-500 mt-1">{t.slogan}</p>
                            </div>
                            
                            {/* Language Switcher */}
                            <button 
                                onClick={toggleLang}
                                className="w-10 h-10 rounded-full bg-white/5 flex items-center justify-center border border-white/10 hover:bg-white/10 hover:text-indigo-300 transition-colors"
                                title="Switch Language"
                            >
                                <span className="text-xs font-bold">{lang === 'zh' ? 'EN' : '‰∏≠'}</span>
                            </button>
                            </header>

                            <TimerSelector />

                            {/* Media scan status and picker */}
                            <div className="mb-4 flex items-center justify-between gap-3">
                                <div className="text-xs text-slate-400">
                                    {scanStatus === 'scanning' && 'Scanning ./Media ...'}
                                    {scanStatus === 'done' && 'Loaded media from ./Media'}
                                    {scanStatus === 'picker' && 'No public directory listing ‚Äî please pick your Media folder (once)'}
                                    {scanStatus === 'error' && 'Auto-scan failed ‚Äî you can pick the folder manually.'}
                                </div>
                                {scanStatus === 'picker' && (
                                <button onClick={pickMediaFolder} className="text-xs px-3 py-1 rounded bg-indigo-600 hover:bg-indigo-500 text-white">Pick Media Folder</button>
                                )}
                            </div>

                            <div className="flex-1 overflow-y-auto pb-20 no-scrollbar">
                            <div className="flex justify-between items-center mb-4">
                                <h3 className="text-sm font-medium text-slate-400">{t.library}</h3>
                            </div>
                            
                            <div className="space-y-3">
                                {tracks.map((track, idx) => (
                                <div 
                                    key={track.id}
                                    onClick={() => startPlayback(idx)}
                                    className="group flex items-center gap-4 p-3 rounded-xl bg-white/5 border border-white/5 hover:bg-white/10 hover:border-indigo-500/30 transition-all duration-300 cursor-pointer active:scale-[0.98]"
                                >
                                    <div className={`w-12 h-12 rounded-lg flex items-center justify-center shadow-lg transition-colors ${
                                    track.cover === 'blue' ? 'bg-gradient-to-br from-blue-600 to-indigo-800' :
                                    track.cover === 'purple' ? 'bg-gradient-to-br from-purple-600 to-fuchsia-800' :
                                    track.cover === 'green' ? 'bg-gradient-to-br from-emerald-600 to-teal-800' :
                                    'bg-slate-700'
                                    }`}>
                                    {track.type === 'video' ? <IconVideo size={20} className="text-white/80" /> : <IconMusic size={20} className="text-white/80" />}
                                    </div>
                                    <div className="flex-1 min-w-0">
                                    <h4 className="font-medium text-slate-200 truncate group-hover:text-indigo-200 transition-colors">
                                        {track.title[lang]}
                                    </h4>
                                    <p className="text-xs text-slate-500 truncate">{track.artist[lang]}</p>
                                    </div>
                                    <div className="w-8 h-8 rounded-full flex items-center justify-center text-slate-500 group-hover:text-indigo-400 group-hover:bg-indigo-500/10 transition-all">
                                    <IconPlay size={16} fill="currentColor" />
                                    </div>
                                </div>
                                ))}
                            </div>
                            </div>
                        </div>
                        )}

                        {/* --- Player Screen --- */}
                        {view === 'player' && currentTrack && (
                        <div className="flex-1 flex flex-col h-full animate-in slide-in-from-bottom-10 fade-in duration-500 relative">
                            
                            {/* Video Background Layer */}
                            {currentTrack.type === 'video' && (
                            <video 
                                ref={videoRef}
                                src={currentTrack.url}
                                loop={timerMode === 'full'}
                                playsInline
                                className="absolute inset-0 w-full h-full object-cover opacity-60 z-0"
                                onEnded={() => {
                                if(timerMode !== 'full') videoRef.current.play(); 
                                }}
                            />
                            )}

                            {/* Audio Element (Hidden) */}
                            {currentTrack.type === 'audio' && (
                            <audio 
                                ref={audioRef}
                                src={currentTrack.url}
                                loop 
                                onEnded={() => audioRef.current.play()} 
                            />
                            )}

                            {/* Stealth Button */}
                            <button 
                            onClick={() => setStealthMode(true)}
                            className="absolute top-6 right-6 z-50 p-3 text-slate-500/30 hover:text-indigo-400 transition-colors duration-500 rounded-full hover:bg-black/20"
                            title={t.stealthHint}
                            >
                            <IconEyeOff size={24} />
                            </button>

                            {/* Back Button */}
                            <button 
                            onClick={() => {
                                pauseMedia();
                                setView('selection');
                            }}
                            className="absolute top-6 left-6 z-50 p-2 text-slate-300 hover:text-white bg-black/20 backdrop-blur-md rounded-full"
                            >
                            <IconChevronLeft size={24} />
                            </button>

                            {/* Main Player UI Overlay */}
                            <div className="relative z-10 flex-1 flex flex-col justify-end p-8 bg-gradient-to-t from-slate-950 via-slate-950/80 to-transparent">
                            
                            {/* Visualizer / Album Art */}
                            {currentTrack.type === 'audio' && (
                                <div className="flex-1 flex items-center justify-center">
                                <div className={`relative w-64 h-64 rounded-full flex items-center justify-center ${isPlaying ? 'animate-pulse-slow' : ''}`}>
                                    <div className={`absolute inset-0 rounded-full blur-3xl opacity-30 ${
                                    currentTrack.cover === 'blue' ? 'bg-blue-600' :
                                    currentTrack.cover === 'purple' ? 'bg-purple-600' :
                                    'bg-emerald-600'
                                    }`} />
                                    <div className="w-48 h-48 rounded-full bg-white/5 border border-white/10 backdrop-blur-md flex items-center justify-center shadow-2xl relative overflow-hidden">
                                    <div className={`absolute inset-0 bg-gradient-to-tr from-transparent via-white/5 to-transparent ${isPlaying ? 'animate-spin-slow' : ''}`} />
                                    <IconMusic size={64} className="text-white/50 relative z-10" />
                                    </div>
                                </div>
                                </div>
                            )}

                            {/* Spacer for video mode */}
                            {currentTrack.type === 'video' && <div className="flex-1" />}

                            {/* Track Info */}
                            <div className="mb-8 text-center">
                                <h2 className="text-2xl font-bold text-white mb-2 drop-shadow-md">{currentTrack.title[lang]}</h2>
                                <p className="text-slate-400 text-sm">{t.playing}</p>
                            </div>

                            {/* Timer Display */}
                            <div className="flex justify-center mb-8">
                                <div className="bg-white/10 backdrop-blur-md px-4 py-1.5 rounded-full flex items-center gap-2 text-indigo-200 text-sm font-mono border border-white/5 shadow-lg">
                                <IconClock size={14} />
                                <span>{timeLeft !== null ? formatTime(timeLeft) : '‚àû'}</span>
                                </div>
                            </div>

                            {/* Controls */}
                            <div className="flex items-center justify-center gap-8 mb-8">
                                <button className="text-slate-500 hover:text-slate-300 transition-colors">
                                <IconShuffle size={20} />
                                </button>

                                <button 
                                onClick={togglePlay}
                                className="w-20 h-20 rounded-full bg-white text-slate-950 flex items-center justify-center shadow-[0_0_40px_-10px_rgba(255,255,255,0.3)] hover:scale-105 active:scale-95 transition-all duration-300"
                                >
                                {isPlaying ? <IconPause size={32} fill="currentColor" /> : <IconPlay size={32} fill="currentColor" className="ml-1" />}
                                </button>

                                <button className="text-slate-500 hover:text-slate-300 transition-colors">
                                <IconRepeat size={20} />
                                </button>
                            </div>

                            {/* Volume Hint */}
                            <div className="flex items-center justify-center gap-2 text-xs text-slate-600">
                                <IconVolume2 size={12} />
                                <span>{t.systemVolume}</span>
                            </div>
                            </div>
                        </div>
                        )}
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>